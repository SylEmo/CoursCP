<!DOCTYPE html>

<html>
<head>
	<meta charset="UTF-8">
	<meta name="robots" content="noindex">
	<title>Liste des projet - Adopi</title>
	<link rel="canonical" href="http://codepen.io/javve/pen/zpuKF">
	<link rel="stylesheet" href="./lib/foundation/css/foundation.min.css">
	<link rel="stylesheet" href="css/liste-projets.css">
  </body>
</head>
<body>
	<h1>Liste de vos projets :</h1>
	<div id="div-projets">
	  <input class="search" placeholder="Rechercher">
	  <button class="sort desc" data-sort="titre">
	    Trier par nom
	  </button>
	  <button class="sort" onclick="document.location.href='ajouter-projet.html'">
	    Ajouter projet
	  </button>
	
	  <ul class="list" id="liste-projets">
	  </ul>
	
	</div>
	<a href="./php/Deconnexion.php">Deconnexion</a>
	
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
	<script src="./js/verif_session.js"></script>
	<script type="text/javascript" src="./lib/listjs/list.js"></script>
	<script src="http://assets.codepen.io/assets/common/stopExecutionOnTimeout.js?t=1"></script>
	<script>
		$(window).load(function(){
			verifSession();	
			
			var projets;
			//on cherche dans le tableau des paramètres le paramètre ID qui correspond à l'id du projet cliqué
			$.ajax({
				url: './php/ListerProjets.php', //toujours la même page qui est appelée
				type: 'POST',
				success: function(data) {
					//on recupère le retour du php qui nous renvoie un tableau contenant toutes les us, séparées par un &
					projets = data.split("\\|/");
					if(!projets[0]){
						document.getElementById('liste-projets').innerHTML += "<li><h3 class='name'>Vous ne possédez pas de projets.</h3></li>";
					}else{
						var options = {
						    valueNames: ['titre','id'],
						    item: '<li><a href="#" onclick="ouvrirProjet($(this))"><h4 class="titre"></h4></a><button id="bouton-supprimer-projet" onclick="supprimerProjet($(this))">Supprimer</button><span class="id" hidden></span></li>'
						};
						var values = [], i = 0;
						while(projets.length>0){
							values[i]= {'id' : projets[0], 'titre' : projets[1]};
							i++;
							projets.shift();
							projets.shift();
						}
						nombreProjets = i;
						var projetsList = new List('div-projets', options, values);
					}
				}
			});
		});

		var ouvrirProjet = function(projetClique){
			var liElements = projetClique.children();
			var idProjet = liElements[2].firstChild;
			document.location.href = "details-projet.html?id=" + idProjet;
		}
		var supprimerProjet = function(projetClique){
			var liElements = projetClique.children();
			var idProjet = liElements[2].firstChild;
			document.location.href="supprimer-projet.html?id="+id;
		}		
	</script>
	<script src="http://codepen.io/assets/editor/live/css_live_reload_init.js"></script>
</body>
</html>