<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Gantt - Adopi</title>
  <link rel="stylesheet" href="./lib/foundation/css/foundation.min.css">
  <link rel="stylesheet" href="./css/gantt.css">
</head>

<body>
	<button onclick="document.location.href='liste-projets.html'">
		Retour accueil
	</button>

	<h1>Gantt de votre sprint n°1</h1>
	<button onclick="editableGrid.ajouterLigne();">Ajouter un développeur</button>
	<div id="conteneur-gantt"></div>
	<button onclick="validerGantt()">Valider le Gantt</button>

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
    <script type="text/javascript" src="http://www.editablegrid.net/editablegrid/editablegrid-2.0.1.js"></script>
    <script type="text/javascript" src="./js/verif_session.js"></script>
    <script type="text/javascript" src="./js/adopi.js"></script>
    <script type="text/javascript">
	$(window).load(function(){
		verifSession();

		editableGrid = new EditableGrid("DemoGridAttach",
			{
				enableSort:true,
			}
		); 
		
		var metadata = [];
		metadata.push({ name: "Numero", datatype: "integer", editable: false });
		metadata.push({ name: "Developpeur", datatype: "string", editable: true });
		metadata.push({ name: "Lundi-matin", datatype: "string", editable: true });
		metadata.push({ name: "Lundi-apresmidi", datatype: "string", editable: true });
		metadata.push({ name: "Mardi-matin", datatype: "string", editable: true });
		metadata.push({ name: "Mardi-apresmidi", datatype: "string", editable: true });
		metadata.push({ name: "Mercredi-matin", datatype: "string", editable: true });
		metadata.push({ name: "Mercredi-apresmidi", datatype: "string", editable: true });
		metadata.push({ name: "Jeudi-matin", datatype: "string", editable: true });
		metadata.push({ name: "Jeudi-apresmidi", datatype: "string", editable: true });
		metadata.push({ name: "Vendredi-matin", datatype: "string", editable: true });
		metadata.push({ name: "Vendredi-apresmidi", datatype: "string", editable: true });
		
		var dataTable = [];
		var tabIds = recupererIdsProjetSprintURL();
		var listeTaches = new Object();
		var recupererTaches = function(){
			var req = $.ajax({
				url: './php/ListerTaches.php', 
				type: 'POST',
				data: {idProjet: tabIds[0], idSprint : tabIds[1]}
			}); 
			req.success(function(data){
				taches = data.split("\\|/");
				if(taches[0]){
					while(taches.length > 3){
						listeTaches["" + taches[1]] = taches[1];
						taches.shift();
						taches.shift();
						taches.shift();
						taches.shift();
					}
					var x;
					for(x = 2; x <= 11; x++){
						metadata[x].values = {};
						metadata[x].values["Taches :"] = listeTaches;
					}
					recupererGantt();
				}
				else{}
			})
		}

		var developpeurs, id = 1;
		var recupererGantt = function(){
			var reqGantt = $.ajax({
				url: './php/ListerGantt.php', 
				type: 'POST',
				data: {idProjet: tabIds[0], idSprint : tabIds[1]}
			});
			reqGantt.success(function(data){
				developpeurs = data.split("\\|/");
				if(developpeurs[0]){
					while(developpeurs.length > 10){
						dataTable.push({id : id, values : {'Numero' : id, 'Developpeur' : developpeurs[0], 'Lundi-matin' : developpeurs[1], 
							"Lundi-apresmidi" : developpeurs[2], "Mardi-matin" : developpeurs[3], "Mardi-apresmidi" : developpeurs[4],
							"Mercredi-matin" : developpeurs[5], "Mercredi-apresmidi" : developpeurs[6], "Jeudi-matin" : developpeurs[7],
							"Jeudi-apresmidi" : developpeurs[8], "Vendredi-matin" : developpeurs[9], "Vendredi-apresmidi" :  developpeurs[10]}});
						id++;
						developpeurs.shift();
						developpeurs.shift();
						developpeurs.shift();
						developpeurs.shift();
						developpeurs.shift();
						developpeurs.shift();
						developpeurs.shift();
						developpeurs.shift();
						developpeurs.shift();
						developpeurs.shift();
						developpeurs.shift();
						developpeurs.shift();
					}
					remplirTableau();
				}
				else{}
			});			
		};

		var remplirTableau = function(){
			editableGrid.load({"metadata": metadata, "data": data});
			editableGrid.renderGrid("conteneur-gantt", "table-gantt");
		}
		
		recupererTaches();
		
		editableGrid.ajouterLigne = function(){
			this.append(this.getRowCount() + 1,{'Numero' : id},false,false);
			id++;
		};
    })

    var validerGantt = function(){
		alert("A faire !");
	}
    </script>
</body>
</html>