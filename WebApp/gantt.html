<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Gantt - Adopi</title>
  <link rel="stylesheet" href="./lib/foundation/css/foundation.min.css">
  <link rel="stylesheet" href="./css/gantt.css">
</head>

<body>
	<button onclick="document.location.href='liste-projets.html'">
		Retour accueil
	</button>

	<h1>Gantt</h1>
	<button onclick="editableGrid.ajouterLigne();">Ajouter un d√©veloppeur</button>
	<div id="conteneur-gantt"></div>
	<button onclick="validerGantt()">Valider le Gantt</button>

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
    <script type="text/javascript" src="http://www.editablegrid.net/editablegrid/editablegrid-2.0.1.js"></script>
    <script type="text/javascript" src="./js/verif_session.js"></script>
    <script type="text/javascript" src="./js/adopi.js"></script>
    <script type="text/javascript">
	$(window).load(function(){
		verifSession();

		editableGrid = new EditableGrid("DemoGridAttach",
			{
				enableSort:true,
			}
		); 
		
		var metadata = [];
		metadata.push({ name: "Numero", datatype: "integer", editable: false });
		metadata.push({ name: "Developpeur", datatype: "string", editable: true });
		metadata.push({ name: "Lundi-matin", datatype: "string", editable: true });
		metadata.push({ name: "Lundi-apresmidi", datatype: "string", editable: true });
		metadata.push({ name: "Mardi-matin", datatype: "string", editable: true });
		metadata.push({ name: "Mardi-apresmidi", datatype: "string", editable: true });
		metadata.push({ name: "Mercredi-matin", datatype: "string", editable: true });
		metadata.push({ name: "Mercredi-apresmidi", datatype: "string", editable: true });
		metadata.push({ name: "Jeudi-matin", datatype: "string", editable: true });
		metadata.push({ name: "Jeudi-apresmidi", datatype: "string", editable: true });
		metadata.push({ name: "Vendredi-matin", datatype: "string", editable: true });
		metadata.push({ name: "Vendredi-apresmidi", datatype: "string", editable: true });
		
		var dataTable = [];
		var tabIds = recupererIdsProjetSprintURL();
		var listeTaches = new Object();
		/*var recupererTaches = function(){
			var req = $.ajax({
				url: './php/ListerTaches.php', 
				type: 'POST',
				data: {idProjet: tabIds[0], idSprint : tabIds[1]}
			}); 
			req.success(function(data){
				taches = data.split("\\|/");
				if(taches[0]){
					while(taches.length > 3){
						listeTaches["" + taches[1]] = taches[1];
						taches.shift();
						taches.shift();
						taches.shift();
						taches.shift();
					}
					var x;
					for(x = 2; x <= 11; x++){
						metadata[x].values = {};
						metadata[x].values["Taches :"] = listeTaches;
					}
					recupererGantt();
				}
				else{}
			})
		}*/

		var developpeurs, id = 1;
		var tabIds = recupererIdsProjetSprintURL();

		var reqGantt = $.ajax({
			url: './php/ListerGantt.php', 
			type: 'POST',
			data: {idProjet: tabIds[0], idSprint : tabIds[1]}
		});
		reqGantt.success(function(data){
			developpeurs = data.split("\\|/");
			if(developpeurs[0]){
				while(developpeurs.length > 10){
					dataTable.push({id : id, values : {'Numero' : developpeurs[0], 'Developpeur' : developpeurs[1], 'Lundi-matin' : developpeurs[2], 
						"Lundi-apresmidi" : developpeurs[3], "Mardi-matin" : developpeurs[4], "Mardi-apresmidi" : developpeurs[5],
						"Mercredi-matin" : developpeurs[6], "Mercredi-apresmidi" : developpeurs[7], "Jeudi-matin" : developpeurs[8],
						"Jeudi-apresmidi" : developpeurs[9], "Vendredi-matin" : developpeurs[10], "Vendredi-apresmidi" :  developpeurs[11]}});
					id++;
					developpeurs.shift();
					developpeurs.shift();
					developpeurs.shift();
					developpeurs.shift();
					developpeurs.shift();
					developpeurs.shift();
					developpeurs.shift();
					developpeurs.shift();
					developpeurs.shift();
					developpeurs.shift();
					developpeurs.shift();
					developpeurs.shift();
				}
				remplirTableau();
			}
			else{}
		});			

		var remplirTableau = function(){
			editableGrid.load({"metadata": metadata, "data": dataTable});
			editableGrid.renderGrid("conteneur-gantt", "table-gantt");
		}
		
		//recupererTaches();
		
		editableGrid.ajouterLigne = function(){
			this.append(this.getRowCount() + 1,{'Developpeur' : 'Dev'},false,false);
			id++;
		};
    })

    var validerGantt = function(){
		var finalGantt = [];
		var tabIds = recupererIdsProjetSprintURL();
		for (var i = 0; i < editableGrid.getRowCount(); i++) {
			finalGantt.push(editableGrid.getRowValues(i));
		};
		$.ajax({
			url: './php/ValiderGantt.php',
			type: 'POST',
			data: {values: finalGantt, idSprint : tabIds[1], idProjet : tabIds[0]},
			success: function(data) {
				window.location.reload();
			}
		});
	}
    </script>
</body>
</html>