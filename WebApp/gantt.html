<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Gantt - Adopi</title>
  <script type="text/javascript" src="http://www.editablegrid.net/editablegrid/editablegrid-2.0.1.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
  <script src="./js/verif_session.js"></script>
  <link rel="stylesheet" href="css/gantt.css">
  
  <script type="text/javascript">
	window.onload=function(){

		verifSession();

		editableGrid = new EditableGrid("tableGantt",
			{
				enableSort:true,
			}
		); 
		
		var metadata = [];
		metadata.push({ name: "numero", datatype: "integer", editable: false });
		metadata.push({ name: "developpeur", datatype: "string", editable: true });
		metadata.push({ name: "lundi-matin", datatype: "string", editable: true });
		metadata.push({ name: "lundi-apresmidi", datatype: "string", editable: true });
		metadata.push({ name: "mardi-matin", datatype: "string", editable: true });
		metadata.push({ name: "mardi-apresmidi", datatype: "string", editable: true });
		metadata.push({ name: "mercredi-matin", datatype: "string", editable: true });
		metadata.push({ name: "mercredi-apresmidi", datatype: "string", editable: true });
		metadata.push({ name: "jeudi-matin", datatype: "string", editable: true });
		metadata.push({ name: "jeudi-apresmidi", datatype: "string", editable: true });
		metadata.push({ name: "vendredi-matin", datatype: "string", editable: true });
		metadata.push({ name: "vendredi-apresmidi", datatype: "string", editable: true });
		
		var x;
		for(x=2 ; x <= 11 ; x++){
			metadata[x].values = {};
			metadata[x].values["Tâches :"] = {"ident1":"ident1","ident2":"ident2","ident3":"ident3","ident4":"ident4"};
		}	
		
		var data = [];
		data.push({id: 1, values: {"numero":"1","developpeur":"Sylvain","lundi-matin":"ident1","lundi-apresmidi":"ident1","mardi-matin":"ident1","mardi-apresmidi":"ident1","mercredi-matin":"ident1","mercredi-apresmidi":"ident1","jeudi-matin":"ident1","jeudi-apresmidi":"ident1","vendredi-matin":"ident1","vendredi-apresmidi":"ident1"}});
		
		editableGrid.load({"metadata": metadata, "data": data});
		editableGrid.renderGrid("conteneur-gantt", "table-gantt");
		
		editableGrid.ajouterLigne = function()
		{
			this.append(this.getRowCount()+1,{},false,false);
			var ligneAjoutee = this.getRow(this.getRowCount() - 1);
			ligneAjoutee.firstChild.innerText = this.getRowCount();
			ligneAjoutee.insertCell(12);
			ligneAjoutee.children[12].innerHTML = "<a onclick=\"editableGrid.removeRow(" + (this.getRowCount()) + ");\">Supprimer</a>";
		};

		var validerGantt = function(){
			alert("A faire !");
		}

		var params = window.location.search;
		var param,uss,us,i;
		params = params.substring(1);
		params = params.split("&");
		alert(params);
		for(i=0; i<params.length;i++){
			param = params[i].split("=");
			if(param[0]=="id"){
				//on cherche dans le tableau des param�tres le param�tre ID qui correspond � l'id du projet cliqu�
				$.ajax({
					url: './php/ListerUserStory.php', //toujours la même page qui est appelée
					type: 'POST',
					data: {id: param[1]}, // paramètre fonction qui détermine la fonction qui sera exécutée
					success: function(data) {
						//on recup�re le retour du php qui nous renvoie un tableau contenant toutes les us, s�par�es par un &
						uss=data.split("&");
						//ERREUR!!!
						//NE RENTRE PAS DANS LE WHILE
						while(uss.length>0){
							//on veut maintenant r�cup�rer chaque info de l'us, s�par�es par un -
							us=uss[0].split("-");
							document.getElementById('htmlgrid').innerHTML += "<tr id='3' style='min-height: 28px;'><td class='number'>"+us[0]+"</td><td>"+us[4]+"</td><td>"+us[1]+"</td><td class='number'>"+us[2]+"</td><td class='number'>"+us[3]+"</td><td><a onclick='editableGrid.removeRow(3);'>Supprimer</a></td></tr>";
							uss.shift();
						}
					}
				});
				//si on trouve le param id, modif pour couper la boucle for, on ne doit avoir qu'un param id
				i = params.lenth;
			}
		}
    }
  </script>

</head>
<body>
	<h1>Gantt de votre sprint n°XXX</h1>
	<a onclick="editableGrid.ajouterLigne();">Ajouter un développeur</a>
	<div id="conteneur-gantt"></div>
	<button onclick="validerGantt">Valider le Gantt</button>
</body>
</html>