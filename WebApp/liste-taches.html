<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Liste des tâches du sprint n°XX - Adopi</title>
  <script type="text/javascript" src="http://www.editablegrid.net/editablegrid/editablegrid-2.0.1.js"></script>
  <link rel="stylesheet" href="./lib/foundation/css/foundation.min.css">
  <link rel="stylesheet" href="./css/backlog.css">
  
</head>
<body>
	<button onclick="document.location.href='liste-projets.html'">
		Retour accueil
	</button>

	<h1>Liste des tâches</h1>
	<button onclick="editableGrid.ajouterLigne();">Ajouter une tâche</button>
	<div id="conteneur_taches"></div>
	<button onclick="validerTaches()">Valider le sprint</button>

	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
    <script src="./js/verif_session.js"></script>
    <script type="text/javascript" src="./js/adopi.js"></script>
	<script type="text/javascript">
	$(window).load(function(){
		verifSession();

		editableGrid = new EditableGrid("DemoGridAttach",
			{
				enableSort:true,
			}
		); 

		var metadata = [];
		metadata.push({ name: "Numero", datatype: "integer", editable: false });
		metadata.push({ name: "Identifiant", datatype: "string", editable: true });
		metadata.push({ name: "Description", datatype: "string", editable: true });
		metadata.push({ name: "Cout", datatype: "integer", editable: true });

		var dataTable = [];
		var tabIds = recupererIdsProjetSprintURL();
		var taches, id = 1;
		$.ajax({
			url: './php/ListerTaches.php', //toujours la même page qui est appelée
			type: 'POST',
			data: {idProjet: tabIds[0], idSprint : tabIds[1]}, // paramètre fonction qui détermine la fonction qui sera exécutée
			success: function(data){
				taches = data.split("\\|/");
				if(taches[0]){
					while(taches.length > 3){
						dataTable.push({id : id, values : {'Numero' : taches[0], 'Identifiant' : taches[1], 'Description' : taches[2], 'Cout' : taches[3]}});
						id++;
						taches.shift();
						taches.shift();
						taches.shift();
						taches.shift();
					}
					editableGrid.load({'metadata' : metadata, 'data' : dataTable});
					editableGrid.renderGrid("conteneur_taches", "table_taches");
				}
			}
		});

		editableGrid.ajouterLigne = function(){
			this.append(this.getRowCount() + 1,{'Identifiant' : 'NewTache'},false,false);
		}
    });

	var validerTaches = function(){
		var finalTaches = [];
		var tabIds = recupererIdsProjetSprintURL();
		for (var i = 0; i < editableGrid.getRowCount(); i++) {
			finalTaches.push(editableGrid.getRowValues(i));
		};
		$.ajax({
			url: './php/ValiderTaches.php',
			type: 'POST',
			data: {values: finalTaches, idSprint : tabIds[1]},
			success: function(data) {
				window.location.reload();
			}
		});
	}
  </script>
</body>
</html>