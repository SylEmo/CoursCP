<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="robots" content="noindex">
	<title>Liste des sprints - Adopi</title>
	<link rel="canonical" href="http://codepen.io/javve/pen/zpuKF">
	<link rel="stylesheet" href="./lib/foundation/css/foundation.min.css">
	<link rel="stylesheet" href="./css/liste-sprints.css">
</head>
<body>
	<button class="btn btn-primary" onclick="document.location.href='liste-projets.html'">
	  Retour accueil
	</button>
	
	<h1>Liste des sprints du projet :</h1>
	
	<div id="div-sprints">
	  <input class="search" placeholder="Rechercher">
	  <button class="sort" data-sort="sprint">
	    Trier par numéro
	  </button>
	  <button id="bouton-nouveau-sprint" onclick="creerSprint()">
	    Créer un nouveau sprint
	  </button>
	  <ul class="list" id="listesprints">
	  </ul>
	
	</div>
	
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
    <script type="text/javascript" src="./js/verif_session.js"></script>
	<script type="text/javascript" src="./lib/listjs/list.js"></script>
	<script type="text/javascript" src="http://assets.codepen.io/assets/common/stopExecutionOnTimeout.js?t=1"></script>
	<script type="text/javascript" src="./js/adopi.js"></script>
	
	<script>
		var nombreSprints = 0;
		var idProjet = recupererIdProjetURL();
		$(window).load(function(){
			verifSession();	
			
			var sprints;
			//on cherche dans le tableau des paramètres le paramètre ID qui correspond à l'id du projet cliqué
			$.ajax({
				url: './php/ListerSprints.php', //toujours la mÃªme page qui est appelÃ©e
				type: 'POST',
				data: {id: idProjet}, // paramÃ¨tre fonction qui dÃ©termine la fonction qui sera exÃ©cutÃ©e
				success: function(data) {
					//on recupère le retour du php qui nous renvoie un tableau contenant toutes les us, séparées par un &
					sprints=data.split("&");
					if(!sprints[0]){
						document.getElementById('listesprints').innerHTML += "<li><h3 class='name'>Ce projet ne possede aucun sprint</h3></li>";
					}else{
						var options = {
						    valueNames: ['sprint','id'],
						    item: '<li><a href="#" onclick="ouvrirSprint($(this))"><h4 class="sprint"></h4></a><button id="bouton-supprimer-sprint" onclick="supprimerSprint($(this))">Supprimer</button><span class="id" hidden></span></li>'
						};
						var values = [], i = 0;
						while(sprints.length>0){
							//on veut maintenant récupérer chaque info de l'us, séparées par un -
							sprint = sprints[0].split("-");
							values[i]= {'id' : sprint[0], 'sprint' : 'Sprint ' + sprint[1]};
							i++;
							sprints.shift();
						}
						nombreSprints = i;
						var sprintsList = new List('div-sprints', options, values);
					}
				}
			});
		});
		var ouvrirSprint = function(sprintClique){
			var liElements = sprintClique.parent().children();
			var idSprint = liElements[2].firstChild.data;
			document.location.href = "details-sprint.html?idSprint=" + idSprint + "&idProjet=" + idProjet;
		}
		var creerSprint = function(){
			document.location.href = "./php/AjouterSprint.php?id=" + idProjet;
		}
		var supprimerSprint = function(boutonSupprimerClique){
			var liElements = boutonSupprimerClique.parent().children();
			var idSprint = liElements[2].firstChild.data;
			document.location.href = "./php/SupprimerSprint.php?idSprint=" + idSprint + "&idProjet=" + idProjet;
		}
		
	</script>
	
	<script src="http://codepen.io/assets/editor/live/css_live_reload_init.js"></script>
</body>
</html>