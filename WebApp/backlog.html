<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Backlog - Adopi</title>
  <link rel="stylesheet" href="./lib/foundation/css/foundation.min.css">
  <link rel="stylesheet" href="./css/backlog.css">
</head>

<body>
	<button onclick="document.location.href='liste-projets.html'">
		Retour accueil
	</button>

	<h1>Backlog</h1>
	<button onclick="editableGrid.ajouterLigne();">Ajouter une ligne</button>
	<div id="conteneur_backlog"></div>
	<button onclick="validerBacklog()">Valider le backlog</button>

	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
	<script type="text/javascript" src="http://www.editablegrid.net/editablegrid/editablegrid-2.0.1.js"></script>
    <script type="text/javascript" src="./js/verif_session.js"></script>
    <script type="text/javascript" src="./js/adopi.js"></script>
    <script type="text/javascript">
	$(window).load(function(){
		verifSession();

		editableGrid = new EditableGrid("DemoGridAttach",
			{
				enableSort:true,
			}
		); 
	
		var metadata = [];
		metadata.push({ name: "Numero", datatype: "integer", editable: false });
		metadata.push({ name: "Identifiant", datatype: "string", editable: true });
		metadata.push({ name: "Userstory", datatype: "string", editable: true });
		metadata.push({ name: "Priorite", datatype: "string", editable: true });
		metadata.push({ name: "Difficulte", datatype: "integer", editable: true });

		var dataTable = [];
		var idProjet = recupererIdProjetURL();
		var uss, id = 1;
		$.ajax({
			url: './php/ListerUserStory.php',
			type: 'POST',
			data: {id: idProjet},
			success: function(data) {
				uss = data.split("\\|/");
				if(uss[0]){
					while(uss.length > 4){
						dataTable.push({id : id, values : {'Numero' : uss[0], 'Identifiant' : uss[1], 'Userstory' : uss[2], 'Priorite' : uss[3], 'Difficulte' : uss[4]}});
						id++;
						uss.shift();
						uss.shift();
						uss.shift();
						uss.shift();
						uss.shift();
					}
					editableGrid.load({'metadata' : metadata, 'data' : dataTable});
					editableGrid.renderGrid("conteneur_backlog", "table_backlog");
				}
			}
		});

		editableGrid.ajouterLigne = function()
		{
			this.append(this.getRowCount() + 1,{'Identifiant' : 'NewID'},false,false);
		}
    });

	
	var validerBacklog = function(){
		var finalUss = [];
		for (var i = 0; i < editableGrid.getRowCount(); i++) {
			finalUss.push(editableGrid.getRowValues(i));
		};
		$.ajax({
			url: './php/ValiderBacklog.php',
			type: 'POST',
			data: {values: finalUss},
			success: function(data) {
				window.location.reload();
			}
		});
	}
    </script>
</body>
</html>