<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Backlog - Adopi</title>
  <script type="text/javascript" src="http://www.editablegrid.net/editablegrid/editablegrid-2.0.1.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
  <script type="text/javascript" src="./js/verif_session.js"></script>
  <script type="text/javascript" src="./js/adopi.js"></script>
  <link rel="stylesheet" href="css/backlog.css">
  
  <script type="text/javascript">
	window.onload=function(){

		verifSession();

		editableGrid = new EditableGrid("DemoGridAttach",
			{
				enableSort:true,
			}
		); 
	
		editableGrid.load({ metadata: [
			{ name: "numero", datatype: "integer", editable: false },
			{ name: "identifiant", datatype: "string", editable: true },
			{ name: "userstory", datatype: "string", editable: true },
			{ name: "priorite", datatype: "string", editable: true },
			{ name: "difficulte", datatype: "integer", editable: true }
		]});
	
		editableGrid.attachToHTMLTable('htmlgrid');
		editableGrid.renderGrid();
		
		editableGrid.ajouterLigne = function()
		{
			this.append(this.getRowCount()+1,{},false,false);
			var ligneAjoutee = this.getRow(this.getRowCount() - 1);
			ligneAjoutee.firstChild.innerText = this.getRowCount();
			ligneAjoutee.insertCell(5);
			ligneAjoutee.children[5].innerHTML = "<a onclick=\"editableGrid.removeRow(" + (this.getRowCount()) + ");\">Supprimer</a>";
		};

		var validerBacklog = function(){
			alert("A faire !");
		}

		var idProjet = recupererIdProjetURL();
		var uss,us;
		//on cherche dans le tableau des param�tres le param�tre ID qui correspond � l'id du projet cliqu�
		$.ajax({
			url: './php/ListerUserStory.php', //toujours la même page qui est appelée
			type: 'POST',
			data: {id: idProjet}, // paramètre fonction qui détermine la fonction qui sera exécutée
			success: function(data) {
				//on recup�re le retour du php qui nous renvoie un tableau contenant toutes les us, s�par�es par un &
				uss=data.split("&");
				if(!uss[0]){
					document.getElementById('htmlgrid').innerHTML += "<tr id='3' style='min-height: 28px;'>Ce projet ne possede aucune userstory</tr>";
				}else{
					while(uss.length>0){
						//on veut maintenant r�cup�rer chaque info de l'us, s�par�es par un -
						us=uss[0].split("-");
						document.getElementById('htmlgrid').innerHTML += "<tr id='3' style='min-height: 28px;'><td class='number'>"+us[0]+"</td><td>"+us[4]+"</td><td>"+us[1]+"</td><td class='number'>"+us[2]+"</td><td class='number'>"+us[3]+"</td><td><a onclick='editableGrid.removeRow("+us[0]+");'>Supprimer</a></td></tr>";
						uss.shift();
					}
				}
			}
		});
    }
  </script>

</head>
<body>
	<button class="btn btn-primary" onclick="document.location.href='liste-projets.html'">
		Retour accueil
	</button>
	<h1>Backlog</h1>
	<a onclick="editableGrid.ajouterLigne();">Ajouter une ligne</a>
	<table id="htmlgrid" class="testgrid">
		<thead><tr>
			<th class="number">Numéro</th>
			<th>Identifiant</th>
			<th>UserStory</th>			
			<th class="number">Priorité</th>
			<th class="number">Difficulté</th>	
		</tr></thead>
	</table>
	<button onclick="validerBacklog">Valider le backlog</button>
</body>
</html>